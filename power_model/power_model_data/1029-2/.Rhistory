rm(list=ls())
library(nnls)
library("nnls", lib="/home//home/R/x86_64-pc-linux-gnu-library/2.14/")
setwd("/home/beitman/Projects/MobEBug/OrigMobEBug/project_code/power_model/")
source("power-model/lib_plot.R")
source("power-model/model_matrix.R")
# Calculation 1: normal approach
coef_calc1 <- function(wifi=T) {
m <- data.frame()
m <- rbind(m, load_base())
m <- rbind(m, load_wifi())
if(wifi == T) {
m <- rbind(m, load_display(T))
m <- rbind(m, load_cpu(T))
} else {
m <- rbind(m, load_display())
m <- rbind(m, load_cpu())
}
#base <- data.frame(mws=max(m$mws), cpu=max(m$cpu), display=max(m$display), wifi=max(m$wifi),
#                   wifi_base=max(m$wifi_base), time_base=max(m$time_base))
#
#m$mws <- m$mws/base$mws
#m$cpu <- m$cpu/base$cpu
#m$display <- m$display/base$display
#if(base$wifi > 0) m$wifi <- m$wifi/base$wifi
#if(base$wifi_base > 0) m$wifi_base <- m$wifi_base/base$wifi_base
#m$time_base <- m$time_base/base$time_base
#plot_data(m, T)
#plot_wifi(m, F)
#plot_cpu(m, F)
#plot_display(m, T)
nnls_a <- cbind(m$cpu, m$display, m$wifi, m$wifi_base, m$time_base)
nnls_b <- m$mws
power.nnls <- nnls(nnls_a, nnls_b)
coef <- data.frame(cpu=power.nnls$x[1], display=power.nnls$x[2],
wifi=power.nnls$x[3], wifi_base=power.nnls$x[4],
time_base=power.nnls$x[5])
if(wifi == T) save(m, coef, nnls_a, nnls_b, power.nnls, file="power_model_data/TEST/coef10ss_wifi.Rdata")
else save(m, coef, nnls_a, nnls_b, power.nnls, file="power_model_data/TEST/coef10ss.Rdata")
return(coef)
}
coef_calc1(T)
rm(list=ls())
#source("lib_plot.R")
home_dir <- "/home/beitman/Projects/MobEBug/OrigMobEBug/project_code/power_model/power_model_data/"
print("input data folder")
wd <- scan(what=character(0), nmax=1)
print("input data folder")
wd <- scan(what=character(0), nmax=1)
setwd(paste(home_dir, wd, sep=""))
print("default mapping Rdata folder is set to 'matrix'")
print("input the mapping Rdata (xxx_mapped.Rdata w/o .Rdata)")
fin <- scan(what=character(0), nmax=1)
wd <- scan(what=character(0), nmax=1)
setwd(paste(home_dir, wd, sep=""))
print("default mapping Rdata folder is set to 'matrix'")
print("input the mapping Rdata (xxx_mapped.Rdata w/o .Rdata)")
fin <- scan(what=character(0), nmax=1)
loc <- "matrix/"
load(paste(loc, fin, ".Rdata", sep=""))
est_matrix_wifi <- data.frame(time=est_matrix$time, time_base=est_matrix$time_base,
wifi_base=est_matrix$wifi_base, display=est_matrix$display)
#interval <- 20 # 10 seconds
interval_list <- c(1,2,10,20,100,200)
for (interval in interval_list){
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
if(wifi_rate_sample >= 1) {
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
if(length(est_matrix$wifi)%%interval<16) {
# discard the last few data because of the short length
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
} else {
est_matrix_wifi$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)] <-
sum(est_matrix$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])
est_matrix_wifi$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)] <-
sum(est_matrix$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])
est_matrix_wifi$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)] <-
sum(est_matrix$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$mws)])
est_matrix_wifi$display[(1+wifi_rate_sample*interval):length(est_matrix$display)] <-
sum(est_matrix$display[(1+wifi_rate_sample*interval):length(est_matrix$display)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$display)])
}
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
} else {
est_matrix_wifi$wifi <- (sum(est_matrix$wifi)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$cpu <- (sum(est_matrix$cpu)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$mws <- (sum(est_matrix$mws)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$display <- (sum(est_matrix$display)/sum(est_matrix$time_base))*est_matrix$time_base
}
save(energy_measured, est_matrix_raw, est_matrix, est_matrix_wifi,
file=paste(loc, fin, interval, "ss_wifi.Rdata", sep=""))
}
for (interval in interval_list){
print("interval ", interval)
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
if(wifi_rate_sample >= 1) {
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
if(length(est_matrix$wifi)%%interval<16) {
# discard the last few data because of the short length
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
} else {
est_matrix_wifi$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)] <-
sum(est_matrix$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])
est_matrix_wifi$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)] <-
sum(est_matrix$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])
est_matrix_wifi$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)] <-
sum(est_matrix$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$mws)])
est_matrix_wifi$display[(1+wifi_rate_sample*interval):length(est_matrix$display)] <-
sum(est_matrix$display[(1+wifi_rate_sample*interval):length(est_matrix$display)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$display)])
}
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
} else {
est_matrix_wifi$wifi <- (sum(est_matrix$wifi)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$cpu <- (sum(est_matrix$cpu)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$mws <- (sum(est_matrix$mws)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$display <- (sum(est_matrix$display)/sum(est_matrix$time_base))*est_matrix$time_base
}
save(energy_measured, est_matrix_raw, est_matrix, est_matrix_wifi,
file=paste(loc, fin, interval, "ss_wifi.Rdata", sep=""))
}
for (interval in interval_list){
print("interval ", interval)
}
for (interval in interval_list){
print("interval ", interval, sep="")
}
for (interval in seq(interval_list){
print("interval ", interval, sep="")
}
for (interval in seq(interval_list)){
print("interval ", interval, sep="")
}
print(interval_list)
for (interval in seq(interval_list)){
print("interval ", interval, sep=" ")
}
for (interval in seq(interval_list)){
cat("interval ", interval, sep=" ")
}
for (interval in seq(interval_list)){
cat("interval ", interval_list$interval, sep="\n")
}
for (interval in seq(interval_list)){
cat("interval ", interval_list(interval), sep="\n")
}
for (interval in seq(interval_list)){
cat("interval ", interval_list[interval], sep="\n")
}
for (iter in seq(interval_list)){
#cat("interval ", interval_list[interval], sep="")
interval = interval_list[iter]
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
if(wifi_rate_sample >= 1) {
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
if(length(est_matrix$wifi)%%interval<16) {
# discard the last few data because of the short length
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
} else {
est_matrix_wifi$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)] <-
sum(est_matrix$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])
est_matrix_wifi$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)] <-
sum(est_matrix$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])
est_matrix_wifi$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)] <-
sum(est_matrix$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$mws)])
est_matrix_wifi$display[(1+wifi_rate_sample*interval):length(est_matrix$display)] <-
sum(est_matrix$display[(1+wifi_rate_sample*interval):length(est_matrix$display)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$display)])
}
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
} else {
est_matrix_wifi$wifi <- (sum(est_matrix$wifi)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$cpu <- (sum(est_matrix$cpu)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$mws <- (sum(est_matrix$mws)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$display <- (sum(est_matrix$display)/sum(est_matrix$time_base))*est_matrix$time_base
}
save(energy_measured, est_matrix_raw, est_matrix, est_matrix_wifi,
file=paste(loc, fin, interval, "ss_wifi.Rdata", sep=""))
}
interval_list <- c(2,10,20,100,200)
for (iter in seq(interval_list)){
#cat("interval ", interval_list[interval], sep="")
interval = interval_list[iter]
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
if(wifi_rate_sample >= 1) {
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
if(length(est_matrix$wifi)%%interval<16) {
# discard the last few data because of the short length
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
} else {
est_matrix_wifi$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)] <-
sum(est_matrix$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])
est_matrix_wifi$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)] <-
sum(est_matrix$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])
est_matrix_wifi$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)] <-
sum(est_matrix$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$mws)])
est_matrix_wifi$display[(1+wifi_rate_sample*interval):length(est_matrix$display)] <-
sum(est_matrix$display[(1+wifi_rate_sample*interval):length(est_matrix$display)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$display)])
}
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
} else {
est_matrix_wifi$wifi <- (sum(est_matrix$wifi)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$cpu <- (sum(est_matrix$cpu)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$mws <- (sum(est_matrix$mws)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$display <- (sum(est_matrix$display)/sum(est_matrix$time_base))*est_matrix$time_base
}
save(energy_measured, est_matrix_raw, est_matrix, est_matrix_wifi,
file=paste(loc, fin, interval, "ss_wifi.Rdata", sep=""))
}
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
if(wifi_rate_sample >= 1) {
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
if(length(est_matrix$wifi)%%interval<16) {
# discard the last few data because of the short length
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
} else {
est_matrix_wifi$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)] <-
sum(est_matrix$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])
est_matrix_wifi$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)] <-
sum(est_matrix$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])
est_matrix_wifi$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)] <-
sum(est_matrix$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$mws)])
est_matrix_wifi$display[(1+wifi_rate_sample*interval):length(est_matrix$display)] <-
sum(est_matrix$display[(1+wifi_rate_sample*interval):length(est_matrix$display)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$display)])
}
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
} else {
est_matrix_wifi$wifi <- (sum(est_matrix$wifi)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$cpu <- (sum(est_matrix$cpu)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$mws <- (sum(est_matrix$mws)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$display <- (sum(est_matrix$display)/sum(est_matrix$time_base))*est_matrix$time_base
}
interval_list <- c(10,20,100,200)
for (iter in seq(interval_list)){
#cat("interval ", interval_list[interval], sep="")
interval = interval_list[iter]
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
if(wifi_rate_sample >= 1) {
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
if(length(est_matrix$wifi)%%interval<16) {
# discard the last few data because of the short length
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
} else {
est_matrix_wifi$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)] <-
sum(est_matrix$wifi[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$wifi)])
est_matrix_wifi$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)] <-
sum(est_matrix$cpu[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$cpu)])
est_matrix_wifi$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)] <-
sum(est_matrix$mws[(1+wifi_rate_sample*interval):length(est_matrix$mws)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$mws)])
est_matrix_wifi$display[(1+wifi_rate_sample*interval):length(est_matrix$display)] <-
sum(est_matrix$display[(1+wifi_rate_sample*interval):length(est_matrix$display)])/
sum(est_matrix$time_base[(1+wifi_rate_sample*interval):length(est_matrix$display)])
}
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
} else {
est_matrix_wifi$wifi <- (sum(est_matrix$wifi)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$cpu <- (sum(est_matrix$cpu)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$mws <- (sum(est_matrix$mws)/sum(est_matrix$time_base))*est_matrix$time_base
est_matrix_wifi$display <- (sum(est_matrix$display)/sum(est_matrix$time_base))*est_matrix$time_base
}
save(energy_measured, est_matrix_raw, est_matrix, est_matrix_wifi,
file=paste(loc, fin, interval, "ss_wifi.Rdata", sep=""))
}
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
length(est_matrix$wifi)%%interval
interval = 10
wifi_rate_sample <- length(est_matrix$wifi)%/%interval
wifi_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$wifi[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
cpu_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$cpu[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
mws_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$mws[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
display_rate <- apply(array(1:wifi_rate_sample), 1,
function(x)
sum(est_matrix$display[(1+interval*(x-1)):(interval*x)])/
sum(est_matrix$time_base[(1+interval*(x-1)):(interval*x)]))
est_matrix_wifi$wifi <- 0
est_matrix_wifi$cpu <- 0
est_matrix_wifi$mws <- 0
est_matrix_wifi$display <- 0
for(x in 1:wifi_rate_sample) {
est_matrix_wifi$wifi[(1+interval*(x-1)):(interval*x)] <- wifi_rate[x]
est_matrix_wifi$cpu[(1+interval*(x-1)):(interval*x)] <- cpu_rate[x]
est_matrix_wifi$mws[(1+interval*(x-1)):(interval*x)] <- mws_rate[x]
est_matrix_wifi$display[(1+interval*(x-1)):(interval*x)] <- display_rate[x]
}
length(est_matrix$wifi)%%interval
est_matrix_wifi <- est_matrix_wifi[1:(wifi_rate_sample*interval),]
est_matrix_wifi$wifi <- est_matrix_wifi$wifi*est_matrix_wifi$time_base
est_matrix_wifi$cpu <- est_matrix_wifi$cpu*est_matrix_wifi$time_base
est_matrix_wifi$mws <- est_matrix_wifi$mws*est_matrix_wifi$time_base
est_matrix_wifi$display <- est_matrix_wifi$display*est_matrix_wifi$time_base
